library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.NUMERIC_STD.ALL;
use work.pkg_types.ALL;

entity top_level is
    generic(
        NUM_FLOORS : integer := 4;
        NUM_ELEV   : integer := 3
    );
    port(
        clk       : in  std_logic;
        reset     : in  std_logic;
        req_panel : in  call_vector_t(NUM_FLOORS-1 downto 0);
        seg7_out  : out std_logic_vector(6 downto 0)
    );
end entity;

architecture rtl of top_level is

    signal request_elevator : call_vector_t(NUM_FLOORS-1 downto 0);
    signal current_floor    : std_logic_vector(1 downto 0);
    signal move_up, move_down, door_open, door_close : std_logic;

begin

    U_LOCAL_CTRL: entity work.local_controller
        generic map(NUM_FLOORS => NUM_FLOORS)
        port map(
            clk           => clk,
            reset         => reset,
            request       => request_elevator,
            current_floor => current_floor,
            move_up       => move_up,
            move_down     => move_down,
            door_open     => door_open,
            door_close    => door_close
        );

    U_SCHEDULER: entity work.scheduler
        generic map(NUM_FLOORS => NUM_FLOORS, NUM_ELEV => NUM_ELEV)
        port map(
            req_from_panel => req_panel,
            req_to_elevator=> request_elevator
        );

    U_SEG7: entity work.seg7_driver
        port map(
            floor => current_floor,
            seg7  => seg7_out
        );

end architecture;

